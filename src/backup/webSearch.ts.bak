
export interface WebSearchOptions {
  limit?: number;
}

export async function webSearch(
  query: string,
  options: WebSearchOptions = {},
): Promise<string> {
  const trimmed = query.trim();
  if (!trimmed) {
    throw new Error('webSearch: query must be a non-empty string');
  }

  const { limit = 10 } = options;
  if (limit < 1 || limit > 100) {
    throw new Error('limit must be between 1 and 100');
  }

  const apiKey = process.env.WEB_SEARCH_API_KEY;
  if (!apiKey) {
    throw new Error('WEB_SEARCH_API_KEY environment variable not set');
  }

  try {
    const response = await fetch(
      `https://api.duckduckgo.com/?q=${encodeURIComponent(trimmed)}&format=json`
    );

    if (!response.ok) {
      throw new Error(`Search API error: ${response.statusText}`);
    }

    const data = await response.json() as Record<string, unknown>;
    const results = (data.webPages as Record<string, unknown>)?.value || [];

    if (!Array.isArray(results) || results.length === 0) {
      return `No search results found for: ${trimmed}`;
    }

    return `Found ${results.length} results for "${trimmed}": ${(results as Array<Record<string, unknown>>).slice(0, limit).map((r: Record<string, unknown>) => r.name).join('; ')}`;
  } catch (error) {
    throw new Error(`Failed to search for "${trimmed}": ${error instanceof Error ? error.message : String(error)}`);
  }
}